{% extends 'base.html.twig' %}

{% block title %}Test - Cr√©ation d'un Film{% endblock %}

{% block body %}
    <div class="container mt-5">
        <h1>Test de cr√©ation d'un Film</h1>
        
        <div class="alert alert-success mt-4">
            <h3>‚úÖ Film cr√©√© avec succ√®s !</h3>
            <p><strong>ID :</strong> {{ movie.id }}</p>
            <p><strong>Titre :</strong> {{ movie.title }}</p>
            <p><strong>R√©alisateur :</strong> {{ movie.director }}</p>
            <p><strong>Ann√©e :</strong> {{ movie.year }}</p>
            <p><strong>Date de cr√©ation :</strong> {{ movie.createdAt|date('d/m/Y H:i:s') }}</p>
        </div>

        {% if logAction %}
            <div class="alert alert-info mt-4">
                <h3>üìù LogAction cr√©√© automatiquement</h3>
                <p><strong>ID :</strong> {{ logAction.id }}</p>
                <p><strong>Action :</strong> {{ logAction.action }}</p>
                <p><strong>Type d'entit√© :</strong> {{ logAction.entityType }}</p>
                <p><strong>ID de l'entit√© :</strong> {{ logAction.entityId }}</p>
                <p><strong>D√©tails :</strong> {{ logAction.details }}</p>
                <p><strong>Date de cr√©ation :</strong> {{ logAction.createdAt|date('d/m/Y H:i:s') }}</p>
            </div>
        {% else %}
            <div class="alert alert-warning mt-4">
                <p>‚ö†Ô∏è Aucun LogAction trouv√© pour ce film.</p>
            </div>
        {% endif %}

        <div class="alert alert-info mt-4">
            <h4>üîç Informations de d√©bogage</h4>
            <ul>
                <li><strong>ID du film cr√©√© :</strong> {{ debug.movieId }}</li>
                <li><strong>Total de logs dans la base :</strong> {{ debug.totalLogs }}</li>
                <li><strong>Logs pour les films :</strong> {{ debug.movieLogsCount }}</li>
            </ul>
        </div>

        <div class="mt-4">
            <h3>üìã Derniers logs (10 derniers)</h3>
            {% if allLogs|length > 0 %}
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Action</th>
                            <th>Type</th>
                            <th>ID Entit√©</th>
                            <th>D√©tails</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for log in allLogs %}
                            <tr>
                                <td>{{ log.id }}</td>
                                <td>{{ log.action }}</td>
                                <td>{{ log.entityType }}</td>
                                <td>{{ log.entityId }}</td>
                                <td>{{ log.details }}</td>
                                <td>{{ log.createdAt|date('d/m/Y H:i:s') }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <div class="alert alert-warning">
                    <p>‚ö†Ô∏è Aucun log trouv√©. Cela peut signifier que :</p>
                    <ul>
                        <li>L'EventSubscriber Doctrine n'est pas enregistr√© correctement</li>
                        <li>L'√©v√©nement n'est pas d√©clench√©</li>
                        <li>L'EventSubscriber Symfony ne cr√©e pas le LogAction</li>
                    </ul>
                </div>
            {% endif %}
        </div>

        <div class="mt-4">
            <a href="{{ path('test_movie_create') }}" class="btn btn-primary">Cr√©er un autre film</a>
            <a href="{{ path('test_movie_list_logs') }}" class="btn btn-secondary">Voir tous les logs</a>
        </div>
    </div>
{% endblock %}

